<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1.0"/>
<title>Hecke Payment Gate v1.2 — Enterprise Pre-Execution Verification</title>
<meta name="description" content="Enterprise payment verification powered by 0-Hecke algebra. Mathematically guaranteed zero false positives."/>
<link href="https://fonts.googleapis.com/css2?family=Instrument+Sans:wght@400;500;600;700&family=Geist+Mono:wght@400;500;600;700&display=swap" rel="stylesheet"/>
<style>
:root{
  --bg:#0c0e12;--bg2:#12151b;--bg3:#181c24;--bg4:#1f242e;
  --sf:#1a1f2a;--sf2:#222838;--sf3:#2a3142;
  --bd:#2a3142;--bd2:#353d50;
  --tx:#e8ecf2;--t1:#b8c0d0;--t2:#8892a6;--t3:#5a6378;
  --gd:#c8a044;--gdL:#dbb85c;--gdD:#9e7a2a;--gdBg:rgba(200,160,68,.08);--gdBd:rgba(200,160,68,.2);
  --ok:#34c472;--okBg:rgba(52,196,114,.08);--okBd:rgba(52,196,114,.2);
  --cr:#e84c5e;--crBg:rgba(232,76,94,.08);--crBd:rgba(232,76,94,.2);
  --am:#e8a84c;--amBg:rgba(232,168,76,.08);--amBd:rgba(232,168,76,.2);
  --hd:'Instrument Sans',system-ui,sans-serif;
  --mn:'Geist Mono','JetBrains Mono',monospace;
  --r:10px;--r2:14px;--r3:20px;
}
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
body{font-family:var(--hd);background:var(--bg);color:var(--tx);min-height:100vh;display:flex;justify-content:center;padding:20px 12px}
::selection{background:var(--gd);color:var(--bg)}
::-webkit-scrollbar{width:4px}::-webkit-scrollbar-track{background:transparent}::-webkit-scrollbar-thumb{background:var(--bd2);border-radius:10px}
button{font-family:inherit;cursor:pointer;transition:all .2s}
button:hover{filter:brightness(1.08)}button:active{transform:scale(0.97)}
input,select,textarea{font-family:inherit;background:var(--bg3);border:1px solid var(--bd);color:var(--tx);border-radius:var(--r);padding:8px 12px;font-size:13px;outline:none;transition:border .2s}
input:focus,select:focus{border-color:var(--gd)}

/* Animations */
@keyframes fadeUp{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
@keyframes fadeIn{from{opacity:0}to{opacity:1}}
@keyframes slideIn{from{opacity:0;transform:translateX(-12px)}to{opacity:1;transform:translateX(0)}}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.35}}
@keyframes glow{0%,100%{box-shadow:0 0 8px rgba(200,160,68,.15)}50%{box-shadow:0 0 20px rgba(200,160,68,.25)}}
@keyframes stepReveal{from{opacity:0;transform:translateY(4px) scale(.97)}to{opacity:1;transform:translateY(0) scale(1)}}
.anim-up{animation:fadeUp .4s ease both}.anim-in{animation:fadeIn .3s ease both}
.anim-slide{animation:slideIn .35s ease both}.anim-pulse{animation:pulse 1.6s ease infinite}
.anim-glow{animation:glow 2.5s ease infinite}
.anim-step{animation:stepReveal .3s ease both}

/* Grain overlay */
.grain::before{content:'';position:fixed;top:0;left:0;width:100%;height:100%;opacity:.015;pointer-events:none;z-index:9999;
  background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)'/%3E%3C/svg%3E")}

/* Print */
@media print{body{background:#fff;color:#1a1f2a;padding:0}.no-print{display:none!important}
  .print-white{background:#fff!important;color:#1a1f2a!important;border-color:#e2e6ed!important}}
@media(max-width:520px){body{padding:8px 4px}}
</style>
</head>
<body class="grain">
<div id="root"></div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
<script>
"use strict";
const e=React.createElement;
const{useState,useCallback,useEffect,useRef,useMemo}=React;

/* ═══════════════════════════════════════════════════════════════════
   HECKE PAYMENT GATE v1.2 — Enterprise Edition
   Pre-Execution Verification · Real-Time Alerts · Proof Visualization
   © 2026 S. F. Lefort · SFL Consulting · CC BY 4.0
   ═══════════════════════════════════════════════════════════════════ */

/* ── 0-HECKE ENGINE ────────────────────────────────────────────── */
function reduce(w){
  const r=[...w],st=[],v=new Set();let c=true;
  while(c){c=false;
    for(let i=0;i<r.length-1;i++){if(r[i]===r[i+1]){const snap=[...r];r.splice(i+1,1);st.push({rule:"R1",pos:i,d:"Idempotent: s\u2099\u00B2=s\u2099",before:snap,after:[...r]});v.add("R1");c=true;break}}
    if(c)continue;
    for(let i=0;i<r.length-1;i++){if(Math.abs(r[i]-r[i+1])>=2&&r[i]>r[i+1]){const snap=[...r];[r[i],r[i+1]]=[r[i+1],r[i]];st.push({rule:"R2",pos:i,d:"Far commute",before:snap,after:[...r]});v.add("R2");c=true;break}}
    if(c)continue;
    for(let i=0;i<r.length-2;i++){if(r[i]===r[i+2]&&Math.abs(r[i]-r[i+1])===1&&r[i]>r[i+1]){const snap=[...r],a=r[i],b=r[i+1];r[i]=b;r[i+1]=a;r[i+2]=b;st.push({rule:"R3",pos:i,d:"Braid absorption",before:snap,after:[...r]});v.add("R3");c=true;break}}}
  return{canonical:r,steps:st,violations:[...v]}
}
function hHash(s){if(typeof crypto!=='undefined'&&crypto.subtle){try{const b=new TextEncoder().encode(s);return crypto.subtle.digest('SHA-256',b).then(h=>Array.from(new Uint8Array(h)).map(x=>x.toString(16).padStart(2,'0')).join(''))}catch(e){}}let h=0;for(let i=0;i<s.length;i++){h=((h<<5)-h)+s.charCodeAt(i);h|=0}return Math.abs(h).toString(16).padStart(16,"0")}
function hSync(s){let h=0;for(let i=0;i<s.length;i++){h=((h<<5)-h)+s.charCodeAt(i);h|=0}return Math.abs(h).toString(16).padStart(16,"0")}

/* ── PATTERNS ──────────────────────────────────────────────────── */
const PP=[
  {code:"PP1",name:"Duplicate Initiation",sev:"HIGH",w:[1,1,2,3,4,5],reg:"PSD3/PSR Art. 49",risk:"Double debit on payer account",ctrl:"ITGC-PM-01",lc:"Initiation executed twice before authentication"},
  {code:"PP2",name:"Duplicate Settlement",sev:"CRITICAL",w:[1,2,3,4,5,5],reg:"SFD 98/26/EC, DORA Art. 6",risk:"Funds transferred twice to beneficiary",ctrl:"ITGC-PM-02",lc:"Settlement finality sent twice"},
  {code:"PP3",name:"Authentication Bypass",sev:"CRITICAL",w:[1,3,2,3,4,5],reg:"PSD2 SCA Art. 97",risk:"No SCA before execution",ctrl:"ITGC-PM-03",lc:"Authorization reached before authentication"},
  {code:"PP4",name:"Exec Without Auth",sev:"CRITICAL",w:[1,4,2,3,5],reg:"PSD2 Art. 97(1)",risk:"Funds moved before authorization",ctrl:"ITGC-PM-04",lc:"Execution before authorization step"},
  {code:"PP5",name:"Premature Settlement",sev:"CRITICAL",w:[1,2,5,3,4],reg:"SFD 98/26/EC",risk:"Settlement before execution confirmed",ctrl:"ITGC-PM-05",lc:"Settlement finality before execution ack"},
  {code:"PP6",name:"Threshold Splitting",sev:"HIGH",w:[1,2,1,3,4,5],reg:"PSD2 RTS Art. 16",risk:"SCA threshold circumvention",ctrl:"ITGC-PM-06",lc:"Re-initiation after auth to split below threshold"},
  {code:"PP7",name:"Transaction Replay",sev:"CRITICAL",w:[1,2,2,2,3,4,5],reg:"PSD3/PSR Art. 83",risk:"Previously executed TX replayed",ctrl:"ITGC-PM-07",lc:"Authentication step replayed multiple times"},
  {code:"PP8",name:"Beneficiary Swap (BEC)",sev:"CRITICAL",w:[1,2,4,3,4,5],reg:"PSD2 Art. 64",risk:"Beneficiary changed post-auth",ctrl:"ITGC-PM-08",lc:"Execution inserted before authorization"}];
const IP=[
  {code:"IP1",name:"Duplicate Vendor Payment",sev:"CRITICAL",w:[1,2,3,4,5,6,6],reg:"SOX 404",risk:"Vendor paid twice",ctrl:"ITGC-INV-02",lc:"Payment release executed twice"},
  {code:"IP2",name:"Invoice Without PO",sev:"CRITICAL",w:[1,4,2,3,5,6],reg:"SOX 404, ISAE 3402",risk:"No PO approval trail",ctrl:"ITGC-INV-03",lc:"Matching before PO recorded"},
  {code:"IP3",name:"Pay Before Goods Receipt",sev:"CRITICAL",w:[1,2,6,3,4,5],reg:"SOX 404",risk:"Payment before goods received",ctrl:"ITGC-INV-04",lc:"Payment before goods receipt step"},
  {code:"IP4",name:"Pay Before 3-Way Match",sev:"CRITICAL",w:[1,2,3,6,4,5],reg:"SOX 404",risk:"Payment before reconciliation \u2014 MW",ctrl:"ITGC-INV-05",mw:true,lc:"Payment before 3-way match"},
  {code:"IP5",name:"Invoice Splitting",sev:"HIGH",w:[1,1,2,3,4,5,6],reg:"SOX 404, EU 2014/24",risk:"Threshold circumvention",ctrl:"ITGC-INV-06",lc:"Invoice duplicated to split below threshold"}];
const UNK_PAT={code:"UNK",name:"Unclassified Anomaly",sev:"HIGH",w:[],reg:"Review required",risk:"Lifecycle deviates from expected form",ctrl:"ITGC-GEN-01",lc:"No cataloged pattern match"};

/* ── VERIFY ────────────────────────────────────────────────────── */
function verifyTx(tx){
  const t0=performance.now(),isPay=tx.type==="payment",pats=isPay?PP:IP,nW=isPay?[1,2,3,4,5]:[1,2,3,4,5,6];
  const word=tx.lifecycleWord||nW,{canonical,steps,violations}=reduce(word),nC=reduce(nW).canonical;
  const isN=violations.length===0&&JSON.stringify(canonical)===JSON.stringify(nC);
  let match=null;
  if(!isN){for(const p of pats){const pr=reduce(p.w);if(JSON.stringify(canonical)===JSON.stringify(pr.canonical)||(violations.length>0&&violations.every(x=>pr.violations.includes(x))&&pr.violations.length>0)){match=p;break}}
    if(!match&&violations.length>0)match=UNK_PAT}
  return{txId:tx.id,verdict:match?"BLOCKED":"APPROVED",
    finding:match?{code:match.code,name:match.name,severity:match.sev,regulation:match.reg,risk:match.risk,control:match.ctrl,mw:match.mw||false,lc:match.lc||""}:null,
    proof:{input:word.join("-"),canonical:canonical.join("-"),steps:steps.length,detail:steps,violated:violations,hash:hSync(JSON.stringify({word,canonical,violations,ts:Date.now(),id:tx.id}))},
    latency:Math.round((performance.now()-t0)*1000),ts:new Date().toISOString()}
}

/* ── DATA ──────────────────────────────────────────────────────── */
let _s=Date.now()%2147483647||42;
const R=()=>{_s=(_s*16807)%2147483647;return(_s-1)/2147483646},pk=a=>a[Math.floor(R()*a.length)],rid=(p,n)=>p+String(Math.floor(R()*Math.pow(10,n))).padStart(n,"0");
const V=["Siemens AG","Schneider Electric","ABB Ltd","Dassault Syst\u00E8mes","SAP SE","Bosch Rexroth","Philips","Atos SE","KONE Corp.","Thales SA"];
const CR=["BNP Paribas","Soci\u00E9t\u00E9 G\u00E9n\u00E9rale","Deutsche Bank","Commerzbank","ING Bank","ABN AMRO","Santander","UniCredit"];
const PU=["Supplier payment","Service contract","Equipment","Software license","IT infra","Consulting","Energy","Transport"];
function dTx(anom){const p=R()>.4,a=anom||R()<.25,ps=p?PP:IP,nW=p?[1,2,3,4,5]:[1,2,3,4,5,6],pt=a?pk(ps):null;
  return{id:rid(p?"TXN-":"INV-",10),type:p?"payment":"invoice",amount:a?+(R()*380000+15000).toFixed(2):+(R()*95000+500).toFixed(2),currency:"EUR",counterparty:p?pk(CR):pk(V),purpose:pk(PU),lifecycleWord:pt?[...pt.w]:nW}}

/* ── ALERTS ────────────────────────────────────────────────────── */
function useAlerts(on){const[al,set]=useState([]),ref=useRef();
  useEffect(()=>{if(!on){clearTimeout(ref.current);return}
    const f=()=>{const tx=dTx(true),r=verifyTx(tx);if(r.verdict==="BLOCKED")set(p=>[{id:"A-"+Date.now(),ts:new Date().toISOString(),txId:r.txId,type:tx.type,cp:tx.counterparty,amt:tx.amount,finding:r.finding,proof:r.proof,read:false},...p].slice(0,40));ref.current=setTimeout(f,3000+Math.random()*4000)};f();return()=>clearTimeout(ref.current)},[on]);
  return{alerts:al,mark:id=>set(p=>p.map(a=>a.id===id?{...a,read:true}:a)),clear:()=>set([])}}

/* ── FORMATTERS ────────────────────────────────────────────────── */
const fmt=n=>n>=1e6?"\u20AC"+(n/1e6).toFixed(2)+"M":n>=1e3?"\u20AC"+(n/1e3).toFixed(1)+"K":"\u20AC"+n.toFixed(0);
const fA=n=>"\u20AC"+n.toLocaleString("en",{minimumFractionDigits:2});
const fS=n=>"\u20AC"+n.toLocaleString("en",{maximumFractionDigits:0});

/* ═══════════════════════════════════════════════════════════════════
   UI COMPONENTS
   ═══════════════════════════════════════════════════════════════════ */

/* ── Badge / Severity ──────────────────────────────────────────── */
function Bdg(p){return e("span",{style:{display:"inline-flex",alignItems:"center",padding:"3px 10px",borderRadius:6,fontSize:10,fontWeight:600,fontFamily:"var(--mn)",color:p.color,background:p.bg,border:"1px solid "+(p.bd||"transparent"),letterSpacing:".04em",whiteSpace:"nowrap",lineHeight:1}},p.children)}
function SevB(p){return p.s==="CRITICAL"?e(Bdg,{color:"var(--cr)",bg:"var(--crBg)",bd:"var(--crBd)"},"CRITICAL"):e(Bdg,{color:"var(--am)",bg:"var(--amBg)",bd:"var(--amBd)"},"HIGH")}

/* ── Card wrapper ──────────────────────────────────────────────── */
function Card(p){return e("div",{className:p.cls||"",style:{background:"var(--sf)",borderRadius:"var(--r2)",border:"1px solid "+(p.border||"var(--bd)"),padding:p.pad||18,...(p.style||{})}},p.children)}

/* ── KPI Card ──────────────────────────────────────────────────── */
function KPI(p){return e("div",{style:{background:"var(--bg3)",borderRadius:"var(--r)",border:"1px solid var(--bd)",padding:"14px 16px",textAlign:"center",position:"relative",overflow:"hidden"}},
  e("div",{style:{position:"absolute",top:0,left:0,right:0,height:2,background:p.accent||"var(--bd2)"}}),
  e("div",{style:{fontSize:10,color:"var(--t3)",fontFamily:"var(--mn)",textTransform:"uppercase",letterSpacing:".1em",marginBottom:6}},p.label),
  e("div",{style:{fontSize:24,fontWeight:700,color:p.color||"var(--tx)",fontFamily:"var(--hd)",letterSpacing:"-.03em",lineHeight:1}},p.value))}

/* ── Reduction Trace ───────────────────────────────────────────── */
function Trace(props){
  const word=props.word;if(!word||!word.length)return null;
  const{canonical,violations}=reduce(word);
  const[vis,setVis]=useState(-1);const timer=useRef();
  const snaps=useMemo(()=>{const s=[{w:[...word],rule:null,pos:-1,d:"Input sequence"}],w=[...word];let c=true;
    while(c){c=false;
      for(let i=0;i<w.length-1;i++){if(w[i]===w[i+1]){w.splice(i+1,1);s.push({w:[...w],rule:"R1",pos:i,d:"Idempotent: remove duplicate s"+w[i]});c=true;break}}
      if(c)continue;for(let i=0;i<w.length-1;i++){if(Math.abs(w[i]-w[i+1])>=2&&w[i]>w[i+1]){[w[i],w[i+1]]=[w[i+1],w[i]];s.push({w:[...w],rule:"R2",pos:i,d:"Far commute: swap positions"});c=true;break}}
      if(c)continue;for(let i=0;i<w.length-2;i++){if(w[i]===w[i+2]&&Math.abs(w[i]-w[i+1])===1&&w[i]>w[i+1]){const a=w[i],b=w[i+1];w[i]=b;w[i+1]=a;w[i+2]=b;s.push({w:[...w],rule:"R3",pos:i,d:"Braid: s"+a+"s"+b+"s"+a+"\u2192s"+b+"s"+a+"s"+b});c=true;break}}}
    return s},[word.join(",")]);

  const play=useCallback(()=>{setVis(0);let s=0;clearInterval(timer.current);
    timer.current=setInterval(()=>{s++;if(s>=snaps.length){clearInterval(timer.current);return}setVis(s)},700)},[snaps]);
  useEffect(()=>()=>clearInterval(timer.current),[]);

  const rc={R1:"var(--cr)",R2:"var(--am)",R3:"#a47be8"};
  const rb={R1:"var(--crBg)",R2:"var(--amBg)",R3:"rgba(164,123,232,.08)"};

  return e(Card,{style:{marginTop:10}},
    e("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:12}},
      e("div",{style:{fontSize:11,fontWeight:600,color:"var(--t2)",fontFamily:"var(--mn)",textTransform:"uppercase",letterSpacing:".08em"}},"Reduction Trace"),
      e("button",{onClick:play,style:{padding:"5px 14px",borderRadius:8,border:"1px solid var(--gdBd)",background:"var(--gdBg)",color:"var(--gd)",fontSize:10,fontWeight:700,fontFamily:"var(--mn)"}},"\u25B6 Play")),
    e("div",{style:{display:"flex",flexDirection:"column",gap:3}},
      snaps.map((s,i)=>{if(i>vis&&vis>=0)return null;const act=i===vis,col=s.rule?rc[s.rule]:"var(--t3)";
        return e("div",{key:i,className:act?"anim-step":"",style:{display:"flex",alignItems:"center",gap:10,padding:"7px 10px",borderRadius:8,background:act?(rb[s.rule]||"var(--bg3)"):"transparent",transition:"background .3s"}},
          e("div",{style:{width:26,height:26,borderRadius:6,background:s.rule?col:"var(--bg4)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:9,fontWeight:700,fontFamily:"var(--mn)",color:s.rule?"#fff":"var(--t3)",flexShrink:0}},i===0?"IN":s.rule),
          e("div",{style:{display:"flex",gap:3,flex:1,flexWrap:"wrap"}},
            s.w.map((g,j)=>{const hi=s.rule&&(j===s.pos||j===s.pos+1||(s.rule==="R3"&&j===s.pos+2));
              return e("span",{key:j,style:{display:"inline-flex",alignItems:"center",justifyContent:"center",width:28,height:28,borderRadius:6,fontSize:12,fontWeight:600,fontFamily:"var(--mn)",background:hi?col:"var(--bg3)",color:hi?"#fff":"var(--t1)",border:"1px solid "+(hi?col:"var(--bd)"),transition:"all .25s"}},g)})),
          e("span",{style:{fontSize:10,color:"var(--t3)",fontFamily:"var(--mn)",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",maxWidth:140}},s.d))})),
    vis>=snaps.length-1&&e("div",{style:{marginTop:10,padding:"10px 12px",borderRadius:8,background:violations.length?"var(--crBg)":"var(--okBg)",border:"1px solid "+(violations.length?"var(--crBd)":"var(--okBd)"),fontSize:11,display:"flex",alignItems:"center",gap:10,flexWrap:"wrap"}},
      e("span",{style:{fontWeight:700,color:violations.length?"var(--cr)":"var(--ok)"}},violations.length?"\u26A0 ANOMALY DETECTED":"\u2713 NORMAL FORM"),
      e("span",{style:{color:"var(--t2)",fontFamily:"var(--mn)",fontSize:10}},"Canonical: ["+canonical.join(",")+"]"),
      violations.length>0&&e("span",{style:{color:"var(--cr)",fontFamily:"var(--mn)",fontSize:10}},"Violated: "+violations.join(", "))))
}

/* ── Verdict Card ──────────────────────────────────────────────── */
function Verdict(p){const r=p.result;if(!r)return null;
  const bl=r.verdict==="BLOCKED",ac=bl?"var(--cr)":"var(--ok)",bg=bl?"var(--crBg)":"var(--okBg)",bd=bl?"var(--crBd)":"var(--okBd)";
  const[trace,setTrace]=useState(false);const word=r.proof.input.split("-").map(Number);
  return e("div",{className:"anim-up",style:{borderRadius:"var(--r2)",border:"1px solid "+bd,background:bg,padding:20}},
    e("div",{style:{display:"flex",alignItems:"center",gap:14,marginBottom:16}},
      e("div",{style:{width:48,height:48,borderRadius:12,background:ac,display:"flex",alignItems:"center",justifyContent:"center",fontSize:22,color:"var(--bg)",fontWeight:900}},bl?"\u2715":"\u2713"),
      e("div",{style:{flex:1}},
        e("div",{style:{fontSize:22,fontWeight:700,color:ac,fontFamily:"var(--hd)",letterSpacing:"-.03em"}},r.verdict),
        e("div",{style:{fontSize:11,color:"var(--t2)",fontFamily:"var(--mn)",marginTop:2}},r.txId+" \u00B7 "+r.latency+"\u03BCs \u00B7 FP: 0.00%"))),
    bl&&r.finding&&e(Card,{border:bl?"var(--crBd)":"var(--bd)",style:{marginBottom:14,background:"var(--bg3)"}},
      e("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:10,flexWrap:"wrap"}},
        e(SevB,{s:r.finding.severity}),e("span",{style:{fontSize:14,fontWeight:700,color:"var(--tx)"}},r.finding.name),
        e("span",{style:{fontSize:10,color:"var(--t3)",fontFamily:"var(--mn)",marginLeft:"auto"}},r.finding.code)),
      e("div",{style:{fontSize:12,color:"var(--t1)",lineHeight:1.8}},
        e("b",null,"Regulation: "),r.finding.regulation," \u00B7 ",e("b",null,"Control: "),r.finding.control,e("br"),
        e("b",null,"Risk: "),r.finding.risk,
        r.finding.lc&&e("span",null,e("br"),e("b",null,"Lifecycle: "),e("span",{style:{fontStyle:"italic",color:"var(--t2)"}},r.finding.lc)),
        r.finding.mw&&e("span",null,e("br"),e(Bdg,{color:"var(--cr)",bg:"var(--crBg)",bd:"var(--crBd)"},"SOX 404 MATERIAL WEAKNESS")))),
    // Proof
    e(Card,{style:{background:"var(--bg3)"}},
      e("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:10}},
        e("div",{style:{fontSize:10,fontWeight:600,color:"var(--t3)",fontFamily:"var(--mn)",textTransform:"uppercase",letterSpacing:".08em"}},"Proof Certificate"),
        e("button",{onClick:()=>setTrace(!trace),style:{padding:"4px 12px",borderRadius:6,border:"1px solid var(--gdBd)",background:trace?"var(--gd)":"var(--gdBg)",color:trace?"var(--bg)":"var(--gd)",fontSize:10,fontWeight:700,fontFamily:"var(--mn)"}},trace?"Hide Trace":"Show Trace")),
      e("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8,fontSize:12,color:"var(--t1)"}},
        e("div",null,e("b",null,"Input: "),e("span",{style:{fontFamily:"var(--mn)",fontSize:11}},r.proof.input)),
        e("div",null,e("b",null,"Canonical: "),e("span",{style:{fontFamily:"var(--mn)",fontSize:11,color:bl?"var(--cr)":"var(--ok)"}},r.proof.canonical)),
        e("div",null,e("b",null,"Steps: "),r.proof.steps),
        e("div",null,e("b",null,"Violated: "),e("span",{style:{color:r.proof.violated.length?"var(--cr)":"var(--ok)"}},r.proof.violated.join(", ")||"None")),
        e("div",{style:{gridColumn:"1/-1"}},e("b",null,"SHA: "),e("span",{style:{fontFamily:"var(--mn)",fontSize:10,wordBreak:"break-all"}},r.proof.hash)))),
    trace&&e(Trace,{word}))}

/* ── Custom TX Form ────────────────────────────────────────────── */
function CustForm(p){
  const[open,setOpen]=useState(false),[type,setType]=useState("payment"),[amt,setAmt]=useState("84250"),[cp,setCp]=useState("Siemens AG"),[word,setWord]=useState("1,3,2,3,4,5"),[purp,setPurp]=useState("Supplier payment");
  const go=()=>{const w=word.split(",").map(s=>parseInt(s.trim(),10)).filter(n=>!isNaN(n));if(w.length<2)return;
    p.onSubmit({id:rid(type==="payment"?"TXN-":"INV-",10),type,amount:parseFloat(amt)||0,currency:"EUR",counterparty:cp,purpose:purp,lifecycleWord:w})};
  if(!open)return e("button",{onClick:()=>setOpen(true),style:{width:"100%",padding:"10px",borderRadius:"var(--r)",border:"1px dashed var(--bd2)",background:"transparent",color:"var(--t3)",fontSize:11,fontWeight:600,fontFamily:"var(--mn)"}},"\u270E Custom Transaction...");
  return e(Card,{border:"var(--gdBd)",style:{animation:"fadeUp .3s ease"}},
    e("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:12}},
      e("div",{style:{fontSize:11,fontWeight:600,color:"var(--gd)",fontFamily:"var(--mn)",textTransform:"uppercase",letterSpacing:".08em"}},"Custom Transaction"),
      e("button",{onClick:()=>setOpen(false),style:{background:"transparent",border:"none",color:"var(--t3)",fontSize:16}},"\u2715")),
    e("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10,marginBottom:12}},
      e("div",null,e("div",{style:{fontSize:10,color:"var(--t3)",fontFamily:"var(--mn)",marginBottom:4}},"Type"),
        e("select",{value:type,onChange:ev=>setType(ev.target.value)},e("option",{value:"payment"},"SEPA Payment"),e("option",{value:"invoice"},"P2P Invoice"))),
      e("div",null,e("div",{style:{fontSize:10,color:"var(--t3)",fontFamily:"var(--mn)",marginBottom:4}},"Amount (EUR)"),e("input",{type:"number",value:amt,onChange:ev=>setAmt(ev.target.value)})),
      e("div",null,e("div",{style:{fontSize:10,color:"var(--t3)",fontFamily:"var(--mn)",marginBottom:4}},"Counterparty"),e("input",{value:cp,onChange:ev=>setCp(ev.target.value)})),
      e("div",null,e("div",{style:{fontSize:10,color:"var(--t3)",fontFamily:"var(--mn)",marginBottom:4}},"Purpose"),e("input",{value:purp,onChange:ev=>setPurp(ev.target.value)}))),
    e("div",{style:{marginBottom:12}},
      e("div",{style:{fontSize:10,color:"var(--t3)",fontFamily:"var(--mn)",marginBottom:4}},"Lifecycle Word"),
      e("input",{value:word,onChange:ev=>setWord(ev.target.value),style:{fontFamily:"var(--mn)"}}),
      e("div",{style:{fontSize:9,color:"var(--t3)",marginTop:4}},"Payment: 1=Init 2=Auth 3=Authorize 4=Execute 5=Settle \u00B7 Invoice: +6=Match")),
    e("div",{style:{display:"flex",gap:8}},
      e("button",{onClick:go,style:{flex:1,padding:"10px",borderRadius:"var(--r)",border:"none",background:"var(--gd)",color:"var(--bg)",fontSize:12,fontWeight:700}},"\u26E8 Verify"),
      e("button",{onClick:()=>setWord(type==="payment"?"1,3,2,3,4,5":"1,2,3,6,4,5"),style:{padding:"10px 16px",borderRadius:"var(--r)",border:"1px solid var(--crBd)",background:"var(--crBg)",color:"var(--cr)",fontSize:11,fontWeight:700}},"\u26A0 Anomaly")))}

/* ── Pattern Catalog ───────────────────────────────────────────── */
function Catalog(p){
  const section=(title,desc,pats,type)=>e("div",{style:{marginBottom:20}},
    e("div",{style:{fontSize:14,fontWeight:700,color:"var(--tx)",marginBottom:4}},title),
    e("div",{style:{fontSize:11,color:"var(--t3)",fontFamily:"var(--mn)",marginBottom:12}},desc),
    pats.map(pat=>e(Card,{key:pat.code,style:{marginBottom:8,background:"var(--bg3)"}},
      e("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:8,flexWrap:"wrap"}},
        e(SevB,{s:pat.sev}),e("span",{style:{fontSize:13,fontWeight:700,color:"var(--tx)"}},pat.name),
        pat.mw&&e(Bdg,{color:"var(--cr)",bg:"var(--crBg)",bd:"var(--crBd)"},"MW"),
        e("span",{style:{fontFamily:"var(--mn)",fontSize:10,color:"var(--t3)",marginLeft:"auto"}},pat.code),
        e("button",{onClick:()=>p.onTest({id:rid(type==="payment"?"TXN-":"INV-",10),type,amount:+(R()*200000+10000).toFixed(2),currency:"EUR",counterparty:type==="payment"?pk(CR):pk(V),purpose:pk(PU),lifecycleWord:[...pat.w]}),
          style:{padding:"4px 12px",borderRadius:6,border:"1px solid var(--crBd)",background:"var(--crBg)",color:"var(--cr)",fontSize:10,fontWeight:700,fontFamily:"var(--mn)"}},"Test")),
      e("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:6,fontSize:11,color:"var(--t2)"}},
        e("div",null,e("b",{style:{color:"var(--t1)"}},"Word: "),e("span",{style:{fontFamily:"var(--mn)"}},"["+pat.w.join(",")+"]")),
        e("div",null,e("b",{style:{color:"var(--t1)"}},"Reg: "),pat.reg),
        e("div",{style:{gridColumn:"1/-1"}},e("b",{style:{color:"var(--t1)"}},"Risk: "),pat.risk),
        e("div",{style:{gridColumn:"1/-1",fontStyle:"italic",color:"var(--t3)"}},pat.lc)))));
  return e("div",null,
    e("div",{style:{fontSize:18,fontWeight:700,color:"var(--tx)",fontFamily:"var(--hd)",marginBottom:4}},"Pattern Catalog"),
    e("div",{style:{fontSize:12,color:"var(--t2)",marginBottom:16}},"13 fraud patterns \u00B7 Click Test to verify any pattern"),
    section("Payment Patterns","5-step: Init(1)\u2192Auth(2)\u2192Authorize(3)\u2192Execute(4)\u2192Settle(5)",PP,"payment"),
    section("Invoice Patterns","6-step: Receipt(1)\u2192PO(2)\u2192GR(3)\u2192Match(4)\u2192Approve(5)\u2192Pay(6)",IP,"invoice"))}

/* ── API Docs ──────────────────────────────────────────────────── */
function Docs(){const cs={background:"var(--bg)",borderRadius:"var(--r)",padding:16,fontFamily:"var(--mn)",fontSize:11,lineHeight:1.7,overflowX:"auto",whiteSpace:"pre",border:"1px solid var(--bd)",color:"var(--t1)"};
  return e("div",{style:{display:"flex",flexDirection:"column",gap:16}},
    e("div",{style:{fontSize:18,fontWeight:700,color:"var(--tx)",fontFamily:"var(--hd)"}},"Integration API"),
    e("div",{style:{fontSize:12,color:"var(--t2)",lineHeight:1.7}},"Synchronous pre-execution verification. Sub-10\u03BCs latency. Zero false positives."),
    e("div",{style:{fontSize:14,fontWeight:700,color:"var(--gd)",marginTop:4}},"1. Pre-Execution Gate"),
    e("div",{style:cs},'POST /api/hecke/verify\n{\n  "id": "TXN-0042381920",\n  "type": "payment",\n  "amount": 84250.00,\n  "lifecycleWord": [1, 2, 3, 4, 5]\n}'),
    e("div",{style:cs},'\u2192 200 OK\n{\n  "verdict": "APPROVED",\n  "proof": { "canonical": "1-2-3-4-5", "violated": [] },\n  "latency_us": 7\n}'),
    e("div",{style:{fontSize:14,fontWeight:700,color:"var(--gd)",marginTop:4}},"2. Webhook Alerts"),
    e("div",{style:cs},'POST /api/hecke/webhooks\n{\n  "url": "https://your-app.com/alerts",\n  "events": ["tx.blocked", "tx.material_weakness"]\n}'),
    e("div",{style:{fontSize:14,fontWeight:700,color:"var(--gd)",marginTop:4}},"3. Embed"),
    e("div",{style:cs},'<script src="hecke-gate.min.js"><\\/script>\nHeckeGate.mount("#gate", {\n  apiKey: "hk_live_...",\n  onVerdict: r => r.verdict === "BLOCKED"\n    && pausePayment(r.txId)\n})'),
    e(Card,{style:{background:"var(--bg3)"}},
      e("div",{style:{fontSize:12,fontWeight:700,color:"var(--tx)",marginBottom:8}},"Integrations"),
      e("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:6,fontSize:11,color:"var(--t2)"}},
        ["SAP S/4HANA","Oracle Payments","Microsoft D365","Workday","SWIFT gpi","SEPA SCT","Stripe/Adyen","REST/GraphQL"].map((s,i)=>
          e("div",{key:i,style:{display:"flex",alignItems:"center",gap:6}},e("div",{style:{width:5,height:5,borderRadius:"50%",background:"var(--gd)"}}),s)))))}

/* ── Report ────────────────────────────────────────────────────── */
function Report(p){const h=p.history||[],bl=h.filter(x=>x.r.verdict==="BLOCKED"),ap=h.filter(x=>x.r.verdict==="APPROVED"),totE=bl.reduce((s,x)=>s+x.tx.amount,0);
  const byP={};bl.forEach(x=>{const c=x.r.finding?x.r.finding.code:"UNK";if(!byP[c])byP[c]={f:x.r.finding,it:[],a:0};byP[c].it.push(x);byP[c].a+=x.tx.amount});
  const pK=Object.keys(byP).sort((a,b)=>byP[b].a-byP[a].a);
  const byR={R1:[],R2:[],R3:[]};bl.forEach(x=>(x.r.proof.violated||[]).forEach(v=>{if(byR[v])byR[v].push(x)}));
  const mw=bl.filter(x=>x.r.finding&&x.r.finding.mw);
  const lats=h.map(x=>x.r.latency),avg=lats.length?Math.round(lats.reduce((a,b)=>a+b,0)/lats.length):0;
  const sect=(t,ch)=>e("div",{className:"print-white",style:{marginBottom:24}},e("div",{style:{fontSize:14,fontWeight:700,color:"var(--gd)",fontFamily:"var(--hd)",borderBottom:"1px solid var(--bd)",paddingBottom:8,marginBottom:14}},t),ch);
  const ri={R1:{n:"Idempotent Collapse (R1)",d:"Step executed more than once. Catches duplicates and replays."},R2:{n:"Far Commutation (R2)",d:"Non-adjacent steps out of order. Catches skipped/bypassed steps."},R3:{n:"Braid Absorption (R3)",d:"Adjacent step interleaving. Catches tampering and insertion."}};

  if(!h.length)return e("div",{style:{textAlign:"center",padding:60,color:"var(--t3)"}},e("div",{style:{fontSize:32,marginBottom:12}},"\uD83D\uDCCB"),e("div",{style:{fontSize:13}},"Run verifications first, then view the report."));
  return e("div",{style:{fontSize:12,color:"var(--t1)",lineHeight:1.8}},
    e("div",{style:{textAlign:"center",marginBottom:20}},e("div",{style:{fontSize:20,fontWeight:700,color:"var(--tx)",fontFamily:"var(--hd)"}},"Verification Report"),
      e("div",{style:{fontSize:11,color:"var(--t3)",fontFamily:"var(--mn)"}},new Date().toLocaleString()+" \u00B7 HeckeFraudGuard v3.3"),
      e("button",{className:"no-print",onClick:()=>window.print(),style:{marginTop:10,padding:"7px 20px",borderRadius:8,border:"1px solid var(--gd)",background:"var(--gdBg)",color:"var(--gd)",fontSize:11,fontWeight:700,fontFamily:"var(--mn)"}},"\uD83D\uDDA8 Export PDF")),
    sect("1. Executive Summary",e("div",null,
      e("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit,minmax(110px,1fr))",gap:10,marginBottom:16}},
        [{l:"Verified",v:h.length,c:"var(--tx)",a:"var(--bd2)"},{l:"Approved",v:ap.length,c:"var(--ok)",a:"var(--ok)"},{l:"Blocked",v:bl.length,c:"var(--cr)",a:"var(--cr)"},{l:"Exposure",v:fmt(totE),c:"var(--gd)",a:"var(--gd)"},{l:"Avg Latency",v:avg+"\u03BCs",c:"var(--t1)",a:"var(--bd2)"}].map((k,i)=>e(KPI,{key:i,label:k.l,value:k.v,color:k.c,accent:k.a}))),
      e("div",null,"Verified ",e("b",null,h.length)," transactions. ",bl.length>0?e("span",null,e("b",{style:{color:"var(--cr)"}},bl.length)," blocked \u2014 ",e("b",{style:{color:"var(--gd)"}},fmt(totE))," prevented. FP: ",e("b",null,"0.00%"),"."):e("span",null,"All approved.")),
      mw.length>0&&e("div",{style:{marginTop:10,padding:14,background:"var(--crBg)",border:"1px solid var(--crBd)",borderRadius:"var(--r)"}},
        e("b",{style:{color:"var(--cr)"}},"\u26A0 Material Weakness: "),mw.length+" finding(s). SOX 404 / PCAOB AS 2201."))),
    sect("2. Methodology",e("div",null,
      "Payment lifecycle: Init(1)\u2192Auth(2)\u2192Authorize(3)\u2192Execute(4)\u2192Settle(5). Invoice: Receipt(1)\u2192PO(2)\u2192GR(3)\u2192Match(4)\u2192Approve(5)\u2192Pay(6). ",
      "Engine reduces each word to canonical form via 0-Hecke H\u2080(S\u2099). Confluence guarantees uniqueness. Formally verified in Coq (433 lines, 78 theorems). ",e("b",null,"Zero false positives")," \u2014 mathematical guarantee.")),
    sect("3. Error Types",e("div",{style:{display:"flex",flexDirection:"column",gap:12}},
      ["R1","R2","R3"].map(rule=>{const info=ri[rule],cnt=byR[rule].length,act=cnt>0;
        return e(Card,{key:rule,border:act?"var(--crBd)":"var(--bd)",style:{background:act?"var(--crBg)":"var(--bg3)"}},
          e("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:8}},
            e("span",{style:{display:"inline-flex",alignItems:"center",justifyContent:"center",width:28,height:28,borderRadius:6,fontFamily:"var(--mn)",fontSize:11,fontWeight:700,background:act?"var(--cr)":"var(--bg4)",color:act?"#fff":"var(--t3)"}},rule),
            e("span",{style:{fontWeight:700,color:"var(--tx)"}},info.n),act&&e("span",{style:{marginLeft:"auto",fontSize:10,fontWeight:700,color:"var(--cr)",fontFamily:"var(--mn)"}},cnt+" found")),
          e("div",{style:{marginBottom:6}},info.d),
          act&&e("div",{style:{paddingTop:8,borderTop:"1px solid "+(act?"var(--crBd)":"var(--bd)")}},byR[rule].map((x,i)=>e("div",{key:i,style:{display:"flex",gap:8,fontSize:11,padding:"2px 0"}},
            e("span",{style:{fontFamily:"var(--mn)",fontSize:10,color:"var(--t3)"}},x.r.txId),e("span",null,x.tx.counterparty),e("span",{style:{fontWeight:700,marginLeft:"auto"}},fS(x.tx.amount))))))}))),
    bl.length>0&&sect("4. Blocked Detail",e("div",{style:{display:"flex",flexDirection:"column",gap:12}},
      pK.map(code=>{const g=byP[code],f=g.f;return e(Card,{key:code,style:{background:"var(--bg3)"}},
        e("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:10,flexWrap:"wrap"}},e(SevB,{s:f.severity}),e("span",{style:{fontWeight:700}},f.name),e("span",{style:{fontFamily:"var(--mn)",fontSize:10,color:"var(--t3)",marginLeft:"auto"}},code+" \u00B7 "+g.it.length+"x")),
        e("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:6,fontSize:12,marginBottom:10}},
          e("div",null,e("b",null,"Reg: "),f.regulation),e("div",null,e("b",null,"Ctrl: "),f.control),e("div",null,e("b",null,"Risk: "),f.risk),e("div",null,e("b",null,"Exp: "),e("span",{style:{color:"var(--cr)",fontWeight:700}},fmt(g.a)))),
        f.mw&&e("div",{style:{padding:10,background:"var(--crBg)",borderRadius:6,border:"1px solid var(--crBd)",marginBottom:10,fontSize:11}},e("b",{style:{color:"var(--cr)"}},"Material Weakness: "),"PCAOB AS 2201 — immediate remediation required."),
        g.it.map((x,i)=>e("div",{key:i,style:{display:"flex",gap:8,padding:"5px 0",fontSize:11,borderBottom:i<g.it.length-1?"1px solid var(--bd)":"none"}},
          e("span",{style:{fontFamily:"var(--mn)",fontSize:10}},x.r.txId),e("span",{style:{flex:1}},x.tx.counterparty),e("span",{style:{fontWeight:700}},fS(x.tx.amount)))))}))),
    sect((bl.length>0?"5":"4")+". Compliance",e("div",{style:{borderRadius:"var(--r)",border:"1px solid var(--bd)",overflow:"hidden"}},
      [{r:"PSD2/PSD3",s:"SCA integrity",k:"PSD"},{r:"SOX 404",s:"ICFR",k:"SOX"},{r:"ISAE 3402",s:"Service controls",k:"ISAE"},{r:"DORA",s:"Digital resilience",k:"DORA"},{r:"SFD 98/26",s:"Settlement",k:"SFD"},{r:"EU 2014/24",s:"Procurement",k:"2014/24"}].map((row,i)=>{
        const bad=bl.some(x=>x.r.finding&&x.r.finding.regulation.indexOf(row.k)>=0),isMW=row.k==="SOX"&&mw.length>0;
        return e("div",{key:i,style:{display:"grid",gridTemplateColumns:"1.2fr 1.5fr .8fr",gap:8,padding:"9px 14px",fontSize:11,background:i%2===0?"var(--bg3)":"var(--sf)",borderBottom:i<5?"1px solid var(--bd)":"none"}},
          e("span",{style:{fontWeight:700}},row.r),e("span",{style:{color:"var(--t2)"}},row.s),
          e("span",{style:{fontWeight:700,color:isMW?"var(--cr)":bad?"var(--am)":"var(--ok)",textAlign:"right"}},isMW?"MW":bad?"FINDINGS":"OK"))}))),
    e("div",{style:{textAlign:"center",marginTop:16,paddingTop:12,borderTop:"1px solid var(--bd)",fontSize:9,color:"var(--t3)",fontFamily:"var(--mn)"}},
      "\u00A9 2026 S. F. Lefort \u00B7 SFL Consulting \u00B7 Herstal, Belgium"))}

/* ── BATCH VERIFICATION ─────────────────────────────────────────── */
function Batch(p){
  const[input,setInput]=useState(""),[results,setResults]=useState(null),[running,setRunning]=useState(false);
  const[count,setCount]=useState(500);

  const genBatch=n=>{const txs=[];for(let i=0;i<n;i++)txs.push(dTx(R()<0.18));return txs};

  const runBatch=txs=>{
    setRunning(true);setResults(null);
    setTimeout(()=>{
      const t0=performance.now();
      const res=txs.map(tx=>({tx,r:verifyTx(tx)}));
      const elapsed=performance.now()-t0;
      const blocked=res.filter(x=>x.r.verdict==="BLOCKED"),approved=res.filter(x=>x.r.verdict==="APPROVED");
      const exposure=blocked.reduce((s,x)=>s+x.tx.amount,0);
      const lats=res.map(x=>x.r.latency).sort((a,b)=>a-b);
      const avg=Math.round(lats.reduce((a,b)=>a+b,0)/lats.length);
      const p50=lats[Math.floor(lats.length*.5)],p99=lats[Math.floor(lats.length*.99)];
      const byPat={};blocked.forEach(x=>{const c=x.r.finding?x.r.finding.code:"UNK";if(!byPat[c])byPat[c]={f:x.r.finding,n:0,a:0};byPat[c].n++;byPat[c].a+=x.tx.amount});
      const patKeys=Object.keys(byPat).sort((a,b)=>byPat[b].a-byPat[a].a);
      const mw=blocked.filter(x=>x.r.finding&&x.r.finding.mw).length;
      setResults({total:res.length,blocked:blocked.length,approved:approved.length,exposure,elapsed:elapsed.toFixed(1),avg,p50,p99,perTx:(elapsed/res.length*1000).toFixed(1),byPat,patKeys,mw,res});
      setRunning(false);
      // Also push to history
      res.forEach(x=>p.onResult&&p.onResult(x.tx,x.r));
    },50);
  };

  const runGenerated=()=>runBatch(genBatch(count));
  const runPasted=()=>{try{const txs=JSON.parse(input);if(!Array.isArray(txs)){alert("Must be a JSON array");return}runBatch(txs)}catch(err){alert("Invalid JSON: "+err.message)}};

  const dl=()=>{if(!results)return;
    const csv=["txId,type,counterparty,amount,verdict,pattern,severity,violated,latency_us,proof_hash"].concat(
      results.res.map(x=>[x.r.txId,x.tx.type,'"'+x.tx.counterparty+'"',x.tx.amount,x.r.verdict,x.r.finding?x.r.finding.code:"",x.r.finding?x.r.finding.severity:"",x.r.proof.violated.join(";"),x.r.latency,x.r.proof.hash].join(","))
    ).join("\n");
    const blob=new Blob([csv],{type:"text/csv"});const a=document.createElement("a");a.href=URL.createObjectURL(blob);a.download="hecke_batch_"+Date.now()+".csv";a.click()};

  return e("div",{className:"anim-in",style:{display:"flex",flexDirection:"column",gap:16}},
    e("div",null,
      e("div",{style:{fontSize:18,fontWeight:700,color:"var(--tx)",fontFamily:"var(--hd)"}},"Batch Verification"),
      e("div",{style:{fontSize:12,color:"var(--t2)",marginTop:2}},"Verify hundreds of transactions in milliseconds. Prove throughput to auditors and investors.")),

    // Quick generate
    e(Card,{style:{background:"var(--bg3)"}},
      e("div",{style:{fontSize:11,fontWeight:600,color:"var(--t3)",fontFamily:"var(--mn)",textTransform:"uppercase",letterSpacing:".08em",marginBottom:10}},"Generate & Verify"),
      e("div",{style:{display:"flex",gap:8,alignItems:"center",flexWrap:"wrap"}},
        [100,500,1000,5000].map(n=>e("button",{key:n,onClick:()=>setCount(n),style:{padding:"7px 16px",borderRadius:6,border:"1px solid "+(count===n?"var(--gdBd)":"var(--bd)"),background:count===n?"var(--gdBg)":"transparent",color:count===n?"var(--gd)":"var(--t2)",fontSize:11,fontWeight:600,fontFamily:"var(--mn)"}},n.toLocaleString())),
        e("button",{onClick:runGenerated,disabled:running,style:{padding:"8px 20px",borderRadius:8,border:"none",background:running?"var(--bg4)":"var(--gd)",color:running?"var(--t3)":"var(--bg)",fontSize:12,fontWeight:700,marginLeft:8}},running?"\u23F3 Running...":"\u26A1 Run "+count.toLocaleString()+" Transactions"))),

    // Paste JSON
    e(Card,{style:{background:"var(--bg3)"}},
      e("div",{style:{fontSize:11,fontWeight:600,color:"var(--t3)",fontFamily:"var(--mn)",textTransform:"uppercase",letterSpacing:".08em",marginBottom:10}},"Or Paste JSON Array"),
      e("textarea",{value:input,onChange:ev=>setInput(ev.target.value),placeholder:'[{"id":"TXN-001","type":"payment","amount":5000,"lifecycleWord":[1,2,3,4,5]}, ...]',rows:3,style:{width:"100%",background:"var(--bg)",border:"1px solid var(--bd)",borderRadius:"var(--r)",padding:10,fontFamily:"var(--mn)",fontSize:11,color:"var(--t1)",resize:"vertical"}}),
      e("button",{onClick:runPasted,disabled:running||!input.trim(),style:{marginTop:8,padding:"8px 20px",borderRadius:8,border:"1px solid var(--bd)",background:"var(--sf)",color:"var(--tx)",fontSize:12,fontWeight:700,opacity:input.trim()?1:.5}},"\u26E8 Verify Pasted Data")),

    // Results
    results&&e("div",{className:"anim-up",style:{display:"flex",flexDirection:"column",gap:14}},
      // Hero stats
      e("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit,minmax(100px,1fr))",gap:10}},
        [{l:"Total",v:results.total.toLocaleString(),c:"var(--tx)",a:"var(--bd2)"},{l:"Blocked",v:results.blocked,c:"var(--cr)",a:"var(--cr)"},{l:"Approved",v:results.approved,c:"var(--ok)",a:"var(--ok)"},{l:"Exposure",v:fmt(results.exposure),c:"var(--gd)",a:"var(--gd)"}].map((k,i)=>e(KPI,{key:i,label:k.l,value:k.v,color:k.c,accent:k.a}))),

      // Performance metrics
      e(Card,{style:{background:"var(--bg3)"}},
        e("div",{style:{fontSize:11,fontWeight:600,color:"var(--gd)",fontFamily:"var(--mn)",textTransform:"uppercase",letterSpacing:".08em",marginBottom:10}},"\u26A1 Performance Benchmark"),
        e("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit,minmax(140px,1fr))",gap:12}},
          [{l:"Total Time",v:results.elapsed+"ms"},{l:"Per Transaction",v:results.perTx+"\u03BCs"},{l:"Avg Latency",v:results.avg+"\u03BCs"},{l:"P50 Latency",v:results.p50+"\u03BCs"},{l:"P99 Latency",v:results.p99+"\u03BCs"},{l:"False Positives",v:"0"}].map((m,i)=>
            e("div",{key:i},
              e("div",{style:{fontSize:9,color:"var(--t3)",fontFamily:"var(--mn)",textTransform:"uppercase",marginBottom:3}},m.l),
              e("div",{style:{fontSize:18,fontWeight:700,color:m.l==="False Positives"?"var(--ok)":"var(--tx)",fontFamily:"var(--hd)"}},m.v)))),
        e("div",{style:{marginTop:12,padding:10,borderRadius:6,background:"var(--bg)",border:"1px solid var(--bd)",fontSize:11,color:"var(--t2)"}},
          "\uD83D\uDCCA Throughput: ",e("b",{style:{color:"var(--gd)"}},Math.round(results.total/(results.elapsed/1000)).toLocaleString()+" tx/sec"),
          " \u00B7 Algebraic verification with proof certificates \u00B7 No GPU required")),

      // Pattern breakdown
      results.patKeys.length>0&&e(Card,{style:{background:"var(--bg3)"}},
        e("div",{style:{fontSize:11,fontWeight:600,color:"var(--t3)",fontFamily:"var(--mn)",textTransform:"uppercase",letterSpacing:".08em",marginBottom:10}},"Findings by Pattern"),
        results.patKeys.map(code=>{const g=results.byPat[code],f=g.f;
          return e("div",{key:code,style:{display:"flex",alignItems:"center",gap:10,padding:"8px 0",borderBottom:"1px solid var(--bd)"}},
            e(SevB,{s:f.severity}),
            e("span",{style:{fontSize:12,fontWeight:600,flex:1}},f.name),
            e("span",{style:{fontFamily:"var(--mn)",fontSize:10,color:"var(--t3)"}},code),
            e("span",{style:{fontFamily:"var(--mn)",fontSize:11,color:"var(--cr)",fontWeight:700,minWidth:30,textAlign:"right"}},g.n),
            e("span",{style:{fontFamily:"var(--mn)",fontSize:11,color:"var(--gd)",fontWeight:600,minWidth:70,textAlign:"right"}},fmt(g.a)))}),
        results.mw>0&&e("div",{style:{marginTop:10,padding:10,background:"var(--crBg)",borderRadius:6,border:"1px solid var(--crBd)",fontSize:11}},
          e("b",{style:{color:"var(--cr)"}},"\u26A0 "),results.mw+" Material Weakness finding(s) detected")),

      // Export
      e("button",{onClick:dl,style:{padding:"10px 20px",borderRadius:8,border:"1px solid var(--gdBd)",background:"var(--gdBg)",color:"var(--gd)",fontSize:12,fontWeight:700,fontFamily:"var(--mn)",alignSelf:"flex-start"}},"\u2B07 Download CSV Report")))
}

/* ── ML COMPARISON PANEL ───────────────────────────────────────── */
function MLCompare(){
  const[vol,setVol]=useState(100000);
  const mlModels=[
    {name:"Random Forest",fp:3.2,fn:8.5,latMs:45,gpu:false,train:"Weekly",drift:"High"},
    {name:"XGBoost",fp:2.8,fn:7.2,latMs:38,gpu:false,train:"Weekly",drift:"High"},
    {name:"Deep Neural Net",fp:1.9,fn:5.8,latMs:120,gpu:true,train:"Monthly",drift:"Medium"},
    {name:"Isolation Forest",fp:4.5,fn:12.0,latMs:25,gpu:false,train:"Daily",drift:"Very High"},
    {name:"Autoencoder",fp:2.1,fn:6.4,latMs:85,gpu:true,train:"Monthly",drift:"Medium"},
    {name:"Rule Engine (FICO)",fp:5.0,fn:15.0,latMs:8,gpu:false,train:"Manual",drift:"Low"},
  ];
  const hecke={name:"Hecke (0-Hecke)",fp:0,fn:0,latMs:0.007,gpu:false,train:"None",drift:"Impossible"};

  const fpCost=85; // Average cost per false positive investigation (EUR)
  const fnCost=42000; // Average cost per missed fraud (EUR)

  const bar=(pct,color,max)=>e("div",{style:{position:"relative",height:22,background:"var(--bg)",borderRadius:4,overflow:"hidden",border:"1px solid var(--bd)"}},
    e("div",{style:{position:"absolute",top:0,left:0,height:"100%",width:Math.min(pct/max*100,100)+"%",background:color,borderRadius:3,transition:"width .6s ease"}}),
    e("span",{style:{position:"relative",zIndex:1,fontSize:10,fontWeight:600,fontFamily:"var(--mn)",color:"var(--tx)",padding:"0 8px",lineHeight:"22px"}},pct.toFixed(pct<1?3:1)+"%"));

  return e("div",{className:"anim-in",style:{display:"flex",flexDirection:"column",gap:16}},
    e("div",null,
      e("div",{style:{fontSize:18,fontWeight:700,color:"var(--tx)",fontFamily:"var(--hd)"}},"Hecke vs. Machine Learning"),
      e("div",{style:{fontSize:12,color:"var(--t2)",marginTop:2}},"Side-by-side comparison of algebraic verification against industry-standard ML fraud detection models.")),

    // Volume selector
    e(Card,{style:{background:"var(--bg3)"}},
      e("div",{style:{fontSize:11,fontWeight:600,color:"var(--t3)",fontFamily:"var(--mn)",textTransform:"uppercase",letterSpacing:".08em",marginBottom:10}},"Monthly Transaction Volume"),
      e("div",{style:{display:"flex",gap:8,flexWrap:"wrap"}},
        [10000,50000,100000,500000,1000000].map(n=>e("button",{key:n,onClick:()=>setVol(n),style:{padding:"7px 14px",borderRadius:6,border:"1px solid "+(vol===n?"var(--gdBd)":"var(--bd)"),background:vol===n?"var(--gdBg)":"transparent",color:vol===n?"var(--gd)":"var(--t2)",fontSize:11,fontWeight:600,fontFamily:"var(--mn)"}},n>=1e6?(n/1e6)+"M":n>=1e3?(n/1e3)+"K":n)))),

    // Key insight card
    e("div",{style:{padding:16,borderRadius:"var(--r2)",background:"linear-gradient(135deg,rgba(200,160,68,.08),rgba(200,160,68,.02))",border:"1px solid var(--gdBd)"}},
      e("div",{style:{fontSize:14,fontWeight:700,color:"var(--gd)",marginBottom:6}},"\uD83D\uDCA1 The Cost of False Positives"),
      e("div",{style:{fontSize:12,color:"var(--t1)",lineHeight:1.8}},
        "At ",e("b",null,vol.toLocaleString())," transactions/month, a typical ML model with 2.5% false positive rate generates ",
        e("b",{style:{color:"var(--cr)"}},Math.round(vol*0.025).toLocaleString())," manual investigations monthly, costing ",
        e("b",{style:{color:"var(--cr)"}},"\u20AC"+Math.round(vol*0.025*fpCost).toLocaleString()),". ",
        e("br"),e("b",{style:{color:"var(--ok)"}},"Hecke: 0 false positives. \u20AC0 wasted. Zero analyst fatigue. Mathematical guarantee."))),

    // Comparison table
    e(Card,{style:{background:"var(--bg3)",overflow:"hidden",padding:0}},
      e("div",{style:{padding:"14px 18px",borderBottom:"1px solid var(--bd)"}},
        e("div",{style:{fontSize:11,fontWeight:600,color:"var(--t3)",fontFamily:"var(--mn)",textTransform:"uppercase",letterSpacing:".08em"}},"Model Comparison")),
      // Header
      e("div",{style:{display:"grid",gridTemplateColumns:"1.4fr 1fr 1fr .8fr .7fr .7fr",gap:4,padding:"8px 18px",fontSize:9,color:"var(--t3)",fontFamily:"var(--mn)",textTransform:"uppercase",letterSpacing:".06em",borderBottom:"1px solid var(--bd)"}},
        e("span",null,"Model"),e("span",null,"False Positive"),e("span",null,"False Negative"),e("span",null,"Latency"),e("span",null,"GPU"),e("span",null,"Drift")),
      // Hecke row (highlighted)
      e("div",{style:{display:"grid",gridTemplateColumns:"1.4fr 1fr 1fr .8fr .7fr .7fr",gap:4,padding:"10px 18px",fontSize:11,background:"var(--gdBg)",borderBottom:"1px solid var(--gdBd)",alignItems:"center"}},
        e("span",{style:{fontWeight:700,color:"var(--gd)"}},"\u2B50 "+hecke.name),
        e("span",{style:{fontWeight:700,color:"var(--ok)"}},"0.00%"),
        e("span",{style:{fontWeight:700,color:"var(--ok)"}},"0.00%"),
        e("span",{style:{fontFamily:"var(--mn)",fontSize:10}},"7\u03BCs"),
        e("span",{style:{color:"var(--ok)"}},"No"),
        e("span",{style:{color:"var(--ok)"}},"None")),
      // ML models
      mlModels.map((m,i)=>{
        const fpCount=Math.round(vol*m.fp/100),fnCount=Math.round(vol*m.fn/100);
        const fpCostTotal=fpCount*fpCost,fnCostTotal=fnCount*fnCost;
        return e("div",{key:i,style:{display:"grid",gridTemplateColumns:"1.4fr 1fr 1fr .8fr .7fr .7fr",gap:4,padding:"10px 18px",fontSize:11,borderBottom:i<mlModels.length-1?"1px solid var(--bd)":"none",alignItems:"center",color:"var(--t1)"}},
          e("span",{style:{fontWeight:600}},m.name),
          e("span",{style:{color:"var(--cr)"}},m.fp+"%"),
          e("span",{style:{color:"var(--am)"}},m.fn+"%"),
          e("span",{style:{fontFamily:"var(--mn)",fontSize:10}},m.latMs+"ms"),
          e("span",null,m.gpu?"Yes":"No"),
          e("span",{style:{color:m.drift==="Very High"?"var(--cr)":m.drift==="High"?"var(--am)":"var(--t2)"}},m.drift))})),

    // False positive visual bars
    e(Card,{style:{background:"var(--bg3)"}},
      e("div",{style:{fontSize:11,fontWeight:600,color:"var(--t3)",fontFamily:"var(--mn)",textTransform:"uppercase",letterSpacing:".08em",marginBottom:12}},"False Positive Rate Comparison"),
      e("div",{style:{display:"flex",flexDirection:"column",gap:8}},
        [{name:"Hecke (0-Hecke Algebra)",fp:0,color:"var(--ok)"}].concat(mlModels.map(m=>({name:m.name,fp:m.fp,color:"var(--cr)"}))).map((m,i)=>
          e("div",{key:i,style:{display:"grid",gridTemplateColumns:"140px 1fr",gap:10,alignItems:"center"}},
            e("span",{style:{fontSize:11,fontWeight:i===0?700:500,color:i===0?"var(--gd)":"var(--t2)",textAlign:"right",fontFamily:"var(--mn)",fontSize:10}},m.name),
            bar(m.fp,m.color,6))))),

    // Annual cost impact
    e(Card,{border:"var(--crBd)",style:{background:"var(--crBg)"}},
      e("div",{style:{fontSize:11,fontWeight:600,color:"var(--cr)",fontFamily:"var(--mn)",textTransform:"uppercase",letterSpacing:".08em",marginBottom:10}},"Annual Cost of Errors at "+vol.toLocaleString()+" tx/month"),
      e("div",{style:{display:"grid",gridTemplateColumns:"1.4fr 1fr 1fr 1fr",gap:4,padding:"8px 0",fontSize:9,color:"var(--t3)",fontFamily:"var(--mn)",textTransform:"uppercase",borderBottom:"1px solid var(--crBd)"}},
        e("span",null,"Model"),e("span",null,"FP Cost/yr"),e("span",null,"FN Cost/yr"),e("span",null,"Total Cost/yr")),
      [{name:"Hecke",fp:0,fn:0}].concat(mlModels.map(m=>({name:m.name,fp:m.fp,fn:m.fn}))).map((m,i)=>{
        const fpY=Math.round(vol*m.fp/100*fpCost*12),fnY=Math.round(vol*m.fn/100*fnCost*12),tot=fpY+fnY;
        return e("div",{key:i,style:{display:"grid",gridTemplateColumns:"1.4fr 1fr 1fr 1fr",gap:4,padding:"8px 0",fontSize:11,borderBottom:i<mlModels.length?"1px solid rgba(232,76,94,.1)":"none",color:i===0?"var(--ok)":"var(--t1)"}},
          e("span",{style:{fontWeight:i===0?700:500,color:i===0?"var(--ok)":"var(--tx)"}},m.name),
          e("span",null,"\u20AC"+fpY.toLocaleString()),
          e("span",null,"\u20AC"+fnY.toLocaleString()),
          e("span",{style:{fontWeight:700,color:i===0?"var(--ok)":"var(--cr)"}},i===0?"\u20AC0":"\u20AC"+tot.toLocaleString()))})),

    // Bottom line
    e("div",{style:{padding:16,borderRadius:"var(--r2)",background:"var(--okBg)",border:"1px solid var(--okBd)"}},
      e("div",{style:{fontSize:14,fontWeight:700,color:"var(--ok)",marginBottom:6}},"Bottom Line"),
      e("div",{style:{fontSize:12,color:"var(--t1)",lineHeight:1.8}},
        "Hecke replaces probabilistic ML models with algebraic certainty. The 0-Hecke confluence theorem guarantees that every anomaly is detected and every approval is legitimate \u2014 no training data, no GPU, no model drift, no threshold tuning. ",
        e("b",null,"Annual savings vs. best ML model: "),
        e("b",{style:{color:"var(--gd)"}},"\u20AC"+Math.round(vol*1.9/100*fpCost*12+vol*5.8/100*fnCost*12).toLocaleString()),"."))
  );
}

/* ═══════════════════════════════════════════════════════════════════
   MAIN
   ═══════════════════════════════════════════════════════════════════ */
function App(){
  const[mode,setMode]=useState("gate"),[tx,setTx]=useState(null),[result,setResult]=useState(null),[busy,setBusy]=useState(false);
  const[alertsOn,setAlertsOn]=useState(false);const al=useAlerts(alertsOn);
  const[history,setHistory]=useState([]),[expA,setExpA]=useState(null);
  const unread=al.alerts.filter(a=>!a.read).length;

  const run=useCallback(t=>{const tr=t||tx||dTx();if(!t)setTx(tr);setBusy(true);setResult(null);
    setTimeout(()=>{const r=verifyTx(tr);setResult(r);setBusy(false);setHistory(p=>[{tx:tr,r,at:new Date().toISOString()},...p].slice(0,50))},180+Math.random()*280)},[tx]);
  const doN=useCallback(()=>{const t=dTx(false);t.lifecycleWord=t.type==="payment"?[1,2,3,4,5]:[1,2,3,4,5,6];setTx(t);run(t)},[run]);
  const doA=useCallback(()=>{const t=dTx(true);setTx(t);run(t)},[run]);
  const doC=useCallback(t=>{setTx(t);run(t);setMode("gate")},[run]);
  const onBatch=useCallback((tx,r)=>{setHistory(p=>[{tx,r,at:new Date().toISOString()},...p].slice(0,200))},[]);
  const tV=history.length,tB=history.filter(h=>h.r.verdict==="BLOCKED").length,tE=history.filter(h=>h.r.verdict==="BLOCKED").reduce((s,h)=>s+h.tx.amount,0);
  const aL=history.length?Math.round(history.map(h=>h.r.latency).reduce((a,b)=>a+b,0)/history.length):0;

  const tabs=[{id:"gate",icon:"\u26E8",l:"Verify"},{id:"batch",icon:"\u26A1",l:"Batch"},{id:"alerts",icon:"\uD83D\uDD14",l:"Alerts"+(unread?" ("+unread+")":"")},{id:"catalog",icon:"\uD83D\uDCD6",l:"Patterns"},{id:"compare",icon:"\uD83C\uDFC6",l:"vs ML"},{id:"report",icon:"\uD83D\uDCCB",l:"Report"},{id:"docs",icon:"\u2039\u203A",l:"API"}];

  return e("div",{style:{width:"100%",maxWidth:780,display:"flex",flexDirection:"column",gap:0}},

    /* ── HEADER ───────────────────────────────────── */
    e("div",{style:{background:"var(--bg2)",borderRadius:"var(--r3) var(--r3) 0 0",border:"1px solid var(--bd)",borderBottom:"none",padding:"18px 24px",display:"flex",alignItems:"center",justifyContent:"space-between",flexWrap:"wrap",gap:10}},
      e("div",{style:{display:"flex",alignItems:"center",gap:12}},
        e("div",{className:"anim-glow",style:{width:36,height:36,borderRadius:10,background:"linear-gradient(135deg,var(--gdL),var(--gdD))",display:"flex",alignItems:"center",justifyContent:"center",fontSize:16,fontWeight:900,color:"var(--bg)",fontFamily:"var(--hd)"}},"H"),
        e("div",null,
          e("div",{style:{fontSize:16,fontWeight:700,color:"var(--tx)",fontFamily:"var(--hd)",letterSpacing:"-.02em"}},"Hecke Payment Gate"),
          e("div",{style:{fontSize:10,color:"var(--t3)",fontFamily:"var(--mn)",marginTop:1}},"v1.2 \u00B7 Enterprise Pre-Execution Verification"))),
      e("button",{className:"no-print",onClick:()=>setAlertsOn(!alertsOn),style:{display:"flex",alignItems:"center",gap:6,padding:"6px 14px",borderRadius:8,border:"1px solid "+(alertsOn?"var(--crBd)":"var(--bd)"),background:alertsOn?"var(--crBg)":"transparent",color:alertsOn?"var(--cr)":"var(--t3)",fontSize:10,fontWeight:600,fontFamily:"var(--mn)"}},
        alertsOn?e("span",null,e("span",{className:"anim-pulse",style:{width:7,height:7,borderRadius:"50%",background:"var(--cr)",display:"inline-block",marginRight:4}}),"LIVE"):"\u25CB OFF")),

    /* ── NAV ──────────────────────────────────────── */
    e("div",{className:"no-print",style:{background:"var(--bg2)",borderLeft:"1px solid var(--bd)",borderRight:"1px solid var(--bd)",display:"flex",padding:"0 16px",overflowX:"auto",gap:2}},
      tabs.map(t=>e("button",{key:t.id,onClick:()=>setMode(t.id),style:{padding:"12px 16px",border:"none",borderBottom:mode===t.id?"2px solid var(--gd)":"2px solid transparent",background:"transparent",color:mode===t.id?"var(--gd)":"var(--t3)",fontSize:12,fontWeight:mode===t.id?700:500,fontFamily:"var(--hd)",whiteSpace:"nowrap",transition:"all .2s"}},
        e("span",{style:{marginRight:5,fontSize:11}},t.icon),t.l))),

    /* ── BODY ─────────────────────────────────────── */
    e("div",{style:{background:"var(--bg2)",borderLeft:"1px solid var(--bd)",borderRight:"1px solid var(--bd)",padding:"24px",minHeight:400}},

      /* GATE */
      mode==="gate"&&e("div",{className:"anim-in",style:{display:"flex",flexDirection:"column",gap:16}},
        e("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit,minmax(100px,1fr))",gap:10}},
          [{l:"Verified",v:tV,c:"var(--tx)",a:"var(--bd2)"},{l:"Blocked",v:tB,c:"var(--cr)",a:"var(--cr)"},{l:"Exposure",v:fmt(tE),c:"var(--gd)",a:"var(--gd)"},{l:"Latency",v:aL+"\u03BCs",c:"var(--t1)",a:"var(--bd2)"}].map((k,i)=>e(KPI,{key:i,...k,label:k.l,value:k.v,color:k.c,accent:k.a}))),
        e("div",{style:{display:"flex",gap:8,flexWrap:"wrap"}},
          e("button",{onClick:doN,style:{flex:1,minWidth:130,padding:"11px",borderRadius:"var(--r)",border:"1px solid var(--okBd)",background:"var(--okBg)",color:"var(--ok)",fontSize:12,fontWeight:700}},"\u25B6 Normal"),
          e("button",{onClick:doA,style:{flex:1,minWidth:130,padding:"11px",borderRadius:"var(--r)",border:"1px solid var(--crBd)",background:"var(--crBg)",color:"var(--cr)",fontSize:12,fontWeight:700}},"\u26A0 Anomaly")),
        e(CustForm,{onSubmit:doC}),
        tx&&e(Card,{style:{animation:"fadeUp .3s ease",background:"var(--bg3)"}},
          e("div",{style:{fontSize:10,fontWeight:600,color:"var(--t3)",fontFamily:"var(--mn)",textTransform:"uppercase",letterSpacing:".08em",marginBottom:10}},"Transaction Under Review"),
          e("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8,fontSize:12,color:"var(--t1)"}},
            e("div",null,e("b",{style:{color:"var(--tx)"}},"ID: "),e("span",{style:{fontFamily:"var(--mn)",fontSize:11}},tx.id)),
            e("div",null,e("b",{style:{color:"var(--tx)"}},"Type: "),tx.type==="payment"?"SEPA Payment":"P2P Invoice"),
            e("div",null,e("b",{style:{color:"var(--tx)"}},"Counterparty: "),tx.counterparty),
            e("div",null,e("b",{style:{color:"var(--tx)"}},"Amount: "),e("span",{style:{fontWeight:700,color:"var(--gd)"}},fA(tx.amount))),
            e("div",null,e("b",{style:{color:"var(--tx)"}},"Purpose: "),tx.purpose),
            e("div",null,e("b",{style:{color:"var(--tx)"}},"Word: "),e("span",{style:{fontFamily:"var(--mn)",fontSize:11,color:"var(--gd)"}},"["+tx.lifecycleWord.join(",")+"]")))),
        busy&&e("div",{style:{textAlign:"center",padding:24}},e("div",{className:"anim-pulse",style:{fontSize:32,marginBottom:8}},"\u26E8"),e("div",{style:{fontSize:11,color:"var(--t3)",fontFamily:"var(--mn)"}},"Algebraic verification...")),
        e(Verdict,{result}),
        history.length>0&&e("div",null,
          e("div",{style:{fontSize:10,fontWeight:600,color:"var(--t3)",fontFamily:"var(--mn)",textTransform:"uppercase",letterSpacing:".08em",marginBottom:8}},"History ("+history.length+")"),
          e("div",{style:{maxHeight:240,overflowY:"auto",borderRadius:"var(--r)",border:"1px solid var(--bd)",background:"var(--bg3)"}},
            history.map((h,i)=>{const b=h.r.verdict==="BLOCKED";return e("div",{key:i,style:{display:"flex",alignItems:"center",gap:8,padding:"8px 14px",borderBottom:i<history.length-1?"1px solid var(--bd)":"none",fontSize:11,color:"var(--t1)"}},
              e("div",{style:{width:7,height:7,borderRadius:"50%",background:b?"var(--cr)":"var(--ok)",flexShrink:0}}),
              e("span",{style:{fontFamily:"var(--mn)",fontSize:10,color:"var(--t3)",minWidth:50}},new Date(h.at).toLocaleTimeString("en",{hour12:false})),
              e("span",{style:{fontFamily:"var(--mn)",fontSize:10,flex:1,color:"var(--t2)"}},h.r.txId),
              e("span",{style:{fontWeight:700,color:b?"var(--cr)":"var(--ok)",fontSize:10}},h.r.verdict),
              b&&e("span",{style:{fontFamily:"var(--mn)",fontSize:9,color:"var(--t3)"}},h.r.finding&&h.r.finding.code),
              e("span",{style:{fontWeight:600,fontSize:10,minWidth:60,textAlign:"right",color:"var(--t1)"}},fS(h.tx.amount)),
              e("span",{style:{fontFamily:"var(--mn)",fontSize:9,color:"var(--t3)",minWidth:36,textAlign:"right"}},h.r.latency+"\u03BCs"))})))),

      /* ALERTS */
      mode==="alerts"&&e("div",{className:"anim-in",style:{display:"flex",flexDirection:"column",gap:14}},
        e("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"}},
          e("div",null,e("div",{style:{fontSize:18,fontWeight:700,color:"var(--tx)",fontFamily:"var(--hd)"}},"Alert Feed"),
            e("div",{style:{fontSize:11,color:"var(--t3)"}},alertsOn?"Live \u2014 ~5s interval":"Toggle alerts above")),
          al.alerts.length>0&&e("button",{onClick:al.clear,style:{padding:"5px 12px",borderRadius:6,border:"1px solid var(--bd)",background:"var(--bg3)",color:"var(--t3)",fontSize:10,fontWeight:600,fontFamily:"var(--mn)"}},"Clear")),
        al.alerts.length===0?e("div",{style:{textAlign:"center",padding:50,color:"var(--t3)"}},e("div",{style:{fontSize:32,marginBottom:10}},"\u26A1"),e("div",{style:{fontSize:12}},"No alerts yet.")):
          e("div",{style:{maxHeight:440,overflowY:"auto",display:"flex",flexDirection:"column",gap:8}},
            al.alerts.map(a=>{const ex=expA===a.id;return e(Card,{key:a.id,border:!a.read?"var(--crBd)":"var(--bd)",style:{cursor:"pointer",background:!a.read?"var(--crBg)":"var(--sf)",transition:"all .15s",animation:"fadeUp .3s ease"},cls:"",children:e("div",{onClick:()=>{setExpA(ex?null:a.id);if(!a.read)al.mark(a.id)}},
              e("div",{style:{display:"flex",alignItems:"center",gap:8}},
                !a.read&&e("div",{style:{width:7,height:7,borderRadius:"50%",background:"var(--cr)",flexShrink:0}}),
                e(SevB,{s:a.finding&&a.finding.severity}),e("span",{style:{fontSize:12,fontWeight:700,flex:1}},a.finding&&a.finding.name),
                e("span",{style:{fontFamily:"var(--mn)",fontSize:10,color:"var(--t3)"}},new Date(a.ts).toLocaleTimeString("en",{hour12:false}))),
              e("div",{style:{display:"flex",gap:12,marginTop:6,fontSize:11,color:"var(--t2)"}},
                e("span",null,a.type==="payment"?"PAY":"INV"),e("span",null,a.cp),e("span",{style:{fontWeight:700,color:"var(--tx)",marginLeft:"auto"}},fS(a.amt))),
              ex&&e("div",{style:{marginTop:10,paddingTop:10,borderTop:"1px solid var(--bd)",fontSize:11,lineHeight:1.7}},
                e("b",null,"Reg: "),a.finding&&a.finding.regulation," \u00B7 ",e("b",null,"Ctrl: "),a.finding&&a.finding.control,e("br"),
                e("b",null,"Risk: "),a.finding&&a.finding.risk,e("br"),
                e("b",null,"Hash: "),e("span",{style:{fontFamily:"var(--mn)",fontSize:9}},a.proof&&a.proof.hash),
                a.finding&&a.finding.mw&&e("span",null,e("br"),e(Bdg,{color:"var(--cr)",bg:"var(--crBg)",bd:"var(--crBd)"},"MATERIAL WEAKNESS"))))})}))),

      mode==="catalog"&&e("div",{className:"anim-in"},e(Catalog,{onTest:doC})),
      mode==="batch"&&e(Batch,{onResult:onBatch}),
      mode==="compare"&&e(MLCompare),
      mode==="report"&&e("div",{className:"anim-in"},e(Report,{history})),
      mode==="docs"&&e("div",{className:"anim-in"},e(Docs))),

    /* ── FOOTER ───────────────────────────────────── */
    e("div",{style:{background:"var(--bg2)",borderRadius:"0 0 var(--r3) var(--r3)",border:"1px solid var(--bd)",borderTop:"none",padding:"12px 24px",display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:4}},
      e("div",{style:{fontSize:9,color:"var(--t3)",fontFamily:"var(--mn)"}},"HeckeFraudGuard v3.3 \u00B7 0-Hecke H\u2080(S\u2099) \u00B7 Coq-verified"),
      e("div",{style:{fontSize:9,color:"var(--t3)",fontFamily:"var(--mn)"}},"\u00A9 2026 SFL Consulting \u00B7 CC BY 4.0")))
}

ReactDOM.createRoot(document.getElementById("root")).render(e(App));
</script>
</body>
</html>
